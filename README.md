# RectifiedHR – High-Resolution Diffusion via Energy Profiling and Adaptive Guidance Scheduling
[![arXiv](https://img.shields.io/badge/arXiv-2506.18208-b31b1b.svg)](https://arxiv.org/abs/2507.09441)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
A research project focused on improving high-resolution image quality generated by latent diffusion models (Stable Diffusion 1.5) through energy profiling and adaptive guidance scheduling.

## 🎯 Project Goal

To analyze and improve high-resolution image quality generated by latent diffusion via:
- Measuring latent energy evolution across denoising steps
- Proposing rectified/adaptive guidance schedules (dynamic CFG)
- Producing visually and quantitatively better high-res images

## 📦 Deliverables
- **Paper**: LaTeX source and PDF in `paper/`
- **Figures**: All referenced images in `paper/figures/`
- **Reproducible Experiments**: Scripts and configs to regenerate results

## 🗂️ Project Structure
```
RectifiedHR-1/
├── run_experiments.py         # Main script: run all experiments for the paper
├── run_single_experiment.py   # Run a single experiment (prompt/config)
├── src/                      # Core modules (generation, energy profiling, adaptive CFG, metrics)
├── utils/                    # Plotting and helper functions
├── experiments/              # Output images/data (minimal, only referenced results)
├── paper/                    # LaTeX, figures, final PDF
│   ├── paper.tex
│   ├── rectifiedhr.pdf
│   └── figures/
├── requirements.txt
├── LICENSE
└── README.md
```

## 🚀 Getting Started

1. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Run all experiments (reproduce paper results):**
   ```bash
   python run_experiments.py 
   ```
   *(Edit the config or script as needed for your hardware/prompts.)*

3. **Run a single experiment:**
   ```bash
   python run_single_experiment.py --prompt "A beautiful landscape..." --cfg_scale 10 --sampler ddim
   ```


## 📊 Results
- Improved high-resolution image quality (512×512)
- Reduced artifacts and improved detail
- Quantitative improvements in CLIP and MS-SSIM scores
- Energy trajectory analysis showing stabilization

## 🖼️ Results Showcase

### Quantitative Comparison

| Config      | Sampler | CFG 3   | CFG 5   | CFG 7   | CFG 10  | CFG 12  | CFG 15  | CFG 18  |
|-------------|---------|---------|---------|---------|---------|---------|---------|---------|
| DPM++ 2M    | dpm++   | 0.9951  | 0.9972  | 0.9985  | 0.9998  | 0.9999  | 0.9998  | 0.9997  |
| DDIM        | ddim    | 0.9948  | 0.9969  | 0.9982  | 0.9999  | 0.9999  | 0.9999  | 0.9998  |
| Euler A     | euler   | 0.9939  | 0.9961  | 0.9978  | 0.9997  | 0.9998  | 0.9997  | 0.9996  |
| HiResFix*   | --      |   --    |   --    |   --    | 0.9987  |   --    |   --    |   --    |
| RectifiedFlow* | --   |   --    |   --    |   --    | 0.9982  |   --    |   --    |   --    |

*Baselines from original papers; may not be directly comparable.

### Artifact vs. Stabilized Output

| High CFG (18): Artifact | Adaptive Schedule: Stabilized |
|:----------------------:|:-----------------------------:|
| ![Artifact](paper/figures/bad_high_cfg_artifact.png) | ![Stabilized](paper/figures/stabilized_output.png) |

*Left: Oversaturation and distortion at high CFG. Right: Clean, artifact-free output with adaptive guidance.*

### Sampler Comparison (Main Prompt)

| DDIM | DPM++ 2M | Euler A |
|:----:|:--------:|:-------:|
| ![DDIM](paper/figures/baseline_ddim_cfg10.0_512_prompt10_20250712_113447.png) | ![DPM++ 2M](paper/figures/baseline_dpm++_2m_cfg10.0_512_prompt10_20250712_114143.png) | ![Euler A](paper/figures/baseline_euler_a_cfg10.0_512_prompt10_20250712_113814.png) |

*All images: Prompt = "A space station orbiting Earth, sci-fi atmosphere", CFG=10*

## 📄 Citation
If you use this work, please cite:
```
@article{Sanjyal2024RectifiedHR,
  title={RectifiedHR: High-Resolution Diffusion via Energy Profiling and Adaptive Guidance Scheduling},
  author={Ankit Sanjyal},
  journal={arXiv preprint arXiv:XXXX.XXXXX},
  year={2024}
}
```

## 📚 Paper
- [arXiv link (to be added)](https://arxiv.org/abs/XXXX.XXXXX)

## 📝 License
This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🤝 Contributing
For questions or contributions, please open an issue or submit a pull request.
